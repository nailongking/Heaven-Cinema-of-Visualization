<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>《怦然心动》趣味动态场景</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; background: #f9f3e9; font-family: "Arial Rounded MT Bold"; }
        .container { text-align: center; }
        h1 { color: #c76b4c; margin-bottom: 20px; }
        button {
            padding: 10px 20px; margin: 0 10px 20px;
            background: #e8a87c; border: none; border-radius: 8px;
            color: white; font-size: 16px; cursor: pointer;
        }
        button:hover { background: #c76b4c; }
        svg { background: #fdf6ed; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .character { transition: all 1s ease; }
        .star { fill: #ffd700; opacity: 0; }
        .trouble-tag { fill: #ff6b6b; opacity: 0; font-size: 14px; font-weight: bold; }
        .egg { transition: all 0.8s ease; }
        .leaf { fill: #7d9d6d; opacity: 0.8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>✨ 怦然心动·双向青涩互动 ✨</h1>
        <button id="juliView">朱莉视角（星星眼）</button>
        <button id="bryceView">布莱斯视角（躲猫猫）</button>
        <button id="reset">重启场景</button>
        <svg width="800" height="500" id="scene"></svg>
    </div>

    <script>
        // 初始化SVG
        const svg = d3.select("#scene");
        const width = 800;
        const height = 500;

        // 1. 绘制背景元素（房屋、草坪、梧桐树）
        // 朱莉家（左侧）
        svg.append("rect").attr("x", 50).attr("y", 300).attr("width", 150).attr("height", 120).attr("fill", "#e8a87c");
        svg.append("rect").attr("x", 80).attr("y", 350).attr("width", 40).attr("height", 70).attr("fill", "#fdf6ed"); // 门
        svg.append("circle").attr("cx", 110).attr("cy", 390).attr("r", 3).attr("fill", "#333"); // 门把手
        // 布莱斯家（右侧）
        svg.append("rect").attr("x", 600).attr("y", 300).attr("width", 150).attr("height", 120).attr("fill", "#a8d0e6");
        svg.append("rect").attr("x", 630).attr("y", 350).attr("width", 40).attr("height", 70).attr("fill", "#fdf6ed"); // 门
        svg.append("circle").attr("cx", 660).attr("cy", 390).attr("r", 3).attr("fill", "#333"); // 门把手
        // 草坪
        svg.append("rect").attr("x", 0).attr("y", 420).attr("width", width).attr("height", 80).attr("fill", "#aed581");
        // 梧桐树（中间）
        const tree = svg.append("g").attr("transform", "translate(400, 250)");
        tree.append("rect").attr("x", -15).attr("y", 0).attr("width", 30).attr("height", 150).attr("fill", "#8d6e63"); // 树干
        const leaves = tree.append("g").attr("class", "leaves");
        // 绘制树冠（多层圆形）
        for (let i = 0; i < 3; i++) {
            leaves.append("circle")
                .attr("r", 60 - i*15)
                .attr("cy", -40 - i*20)
                .attr("fill", "#7d9d6d");
        }

        // 2. 绘制角色（朱莉和布莱斯）
        // 朱莉（左侧）
        const juli = svg.append("g").attr("class", "character").attr("transform", "translate(150, 400)");
        juli.append("circle").attr("r", 25).attr("fill", "#ffd1dc").attr("class", "head"); // 头
        juli.append("rect").attr("x", -15).attr("y", 25).attr("width", 30).attr("height", 40).attr("fill", "#ff9e80").attr("class", "body"); // 身体
        juli.append("line").attr("x1", -10).attr("y1", 65).attr("x2", -20).attr("y2", 90).attr("stroke", "#333").attr("stroke-width", 3); // 左腿
        juli.append("line").attr("x1", 10).attr("y1", 65).attr("x2", 20).attr("y2", 90).attr("stroke", "#333").attr("stroke-width", 3); // 右腿
        juli.append("line").attr("x1", -15).attr("y1", 35).attr("x2", -35).attr("y2", 55).attr("stroke", "#333").attr("stroke-width", 3); // 左臂
        juli.append("line").attr("x1", 15).attr("y1", 35).attr("x2", 35).attr("y2", 55).attr("stroke", "#333").attr("stroke-width", 3); // 右臂
        // 布莱斯（右侧）
        const bryce = svg.append("g").attr("class", "character").attr("transform", "translate(650, 400)");
        bryce.append("circle").attr("r", 25).attr("fill", "#ffe0b2").attr("class", "head"); // 头
        bryce.append("rect").attr("x", -15).attr("y", 25).attr("width", 30).attr("height", 40).attr("fill", "#64b5f6").attr("class", "body"); // 身体
        bryce.append("line").attr("x1", -10).attr("y1", 65).attr("x2", -20).attr("y2", 90).attr("stroke", "#333").attr("stroke-width", 3); // 左腿
        bryce.append("line").attr("x1", 10).attr("y1", 65).attr("x2", 20).attr("y2", 90).attr("stroke", "#333").attr("stroke-width", 3); // 右腿
        bryce.append("line").attr("x1", -15).attr("y1", 35).attr("x2", -35).attr("y2", 55).attr("stroke", "#333").attr("stroke-width", 3); // 左臂
        bryce.append("line").attr("x1", 15).attr("y1", 35).attr("x2", 35).attr("y2", 55).attr("stroke", "#333").attr("stroke-width", 3); // 右臂

        // 3. 绘制道具（鸡蛋、星星滤镜、麻烦标签）
        const egg = svg.append("ellipse")
            .attr("class", "egg")
            .attr("cx", 300)
            .attr("cy", 400)
            .attr("rx", 10)
            .attr("ry", 14)
            .attr("fill", "#fff3e0")
            .attr("stroke", "#ffcc80")
            .attr("stroke-width", 1);
        // 朱莉视角的星星滤镜
        const stars = svg.append("g").attr("class", "star-group");
        for (let i = 0; i < 8; i++) {
            stars.append("path")
                .attr("class", "star")
                .attr("d", "M0,-10 L2,-3 L9,-3 L4,1 L6,-8 L0,-4 L-6,-8 L-4,1 L-9,-3 L-2,-3 Z")
                .attr("transform", `translate(650, 370) rotate(${i*45}) scale(0.8)`)
                .attr("x", 650)
                .attr("y", 370);
        }
        // 布莱斯视角的麻烦标签
        const troubleTag = svg.append("text")
            .attr("class", "trouble-tag")
            .attr("x", 150)
            .attr("y", 350)
            .text("麻烦！");

        // 4. 绘制落叶（随机飘落动画）
        function createLeaves() {
            const leaf = svg.append("path")
                .attr("class", "leaf")
                .attr("d", "M0,0 C5,5 10,5 10,0 C10,-5 5,-5 0,0 Z")
                .attr("x", Math.random()*width)
                .attr("y", -20)
                .attr("transform", `rotate(${Math.random()*360})`);

            // 落叶动画
            leaf.transition()
                .duration(3000 + Math.random()*2000)
                .attr("y", height)
                .attr("x", leaf.attr("x") * 1 + Math.random()*50 - 25)
                .ease(d3.easeLinear)
                .on("end", () => leaf.remove());
        }
        // 每隔1秒生成一片落叶
        setInterval(createLeaves, 1000);

        // 5. 交互逻辑（视角切换+动态效果）
        // 朱莉视角：布莱斯加星星滤镜，两人慢慢靠近，朱莉递鸡蛋
        d3.select("#juliView").on("click", () => {
            stars.selectAll(".star").transition().duration(1000).attr("opacity", 1);
            troubleTag.transition().duration(500).attr("opacity", 0);

            // 角色移动
            juli.transition().duration(2000).attr("transform", "translate(250, 400)");
            bryce.transition().duration(2000).attr("transform", "translate(550, 400)");

            // 鸡蛋移动到朱莉手上
            egg.transition().duration(1500).attr("cx", 270).attr("cy", 380);

            // 梧桐树摇摆（喜剧夸张效果）
            tree.transition().duration(500).attr("transform", "translate(400, 250) rotate(5)")
                .transition().duration(500).attr("transform", "translate(400, 250) rotate(-5)")
                .transition().duration(500).attr("transform", "translate(400, 250) rotate(0)");
        });

        // 布莱斯视角：朱莉加麻烦标签，布莱斯后退躲闪，鸡蛋掉落
        d3.select("#bryceView").on("click", () => {
            troubleTag.transition().duration(1000).attr("opacity", 1);
            stars.selectAll(".star").transition().duration(500).attr("opacity", 0);

            // 角色移动（布莱斯躲闪）
            juli.transition().duration(2000).attr("transform", "translate(250, 400)");
            bryce.transition().duration(2000).attr("transform", "translate(700, 400)");

            // 鸡蛋掉落
            egg.transition().duration(800).attr("cx", 270).attr("cy", 450)
                .transition().duration(300).attr("opacity", 0)
                .on("end", () => egg.attr("opacity", 1).attr("cx", 300).attr("cy", 400));
        });

        // 重启场景
        d3.select("#reset").on("click", () => {
            // 角色回到初始位置
            juli.transition().duration(1000).attr("transform", "translate(150, 400)");
            bryce.transition().duration(1000).attr("transform", "translate(650, 400)");

            // 隐藏特效
            stars.selectAll(".star").transition().duration(500).attr("opacity", 0);
            troubleTag.transition().duration(500).attr("opacity", 0);

            // 鸡蛋回到初始位置
            egg.transition().duration(1000).attr("cx", 300).attr("cy", 400);
        });

        // 初始自动触发梧桐树摇摆
        setTimeout(() => {
            tree.transition().duration(500).attr("transform", "translate(400, 250) rotate(3)")
                .transition().duration(500).attr("transform", "translate(400, 250) rotate(-3)")
                .transition().duration(500).attr("transform", "translate(400, 250) rotate(0)");
        }, 1000);
    </script>
</body>
</html>